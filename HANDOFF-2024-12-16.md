# Quantum Garden Development Handoff
## Session: December 16, 2024

---

## ğŸ¯ FOR NEW INSTANCE: READ THESE FILES FIRST (IN ORDER)

**Minimal context load - DO NOT read the full HTML file unless needed:**

1. `/mnt/project/quantum-garden-design-doc-v4.md` - Full feature design, roadmap, mechanics
2. `/mnt/project/quantum-garden-todo.md` - Current task checklist with âœ…/â¬œ status
3. `/mnt/project/quantum-garden-mechanics.md` - Core game mechanics reference
4. `/mnt/project/quantum-garden-architecture.md` - Code structure guide (if exists)

**Only read specific sections of `quantum-garden.html` when making targeted edits.**

---

## ğŸ“Š CURRENT STATE

- **Lines of Code:** 8,807
- **File:** Single monolithic HTML with embedded CSS + JS
- **Hosted:** garden.fractaloutlook.com
- **Repo:** github.com/fractaloutlook/inc

### Game Features Implemented
- 6 plant types with growth cycles and harvesting
- 6 mutation types with yield bonuses
- Quantum coherence mechanic (clicking maintains it, affects production)
- Entanglement system (link two plants for sync harvests)
- Observer effect (hovering speeds growth)
- Prestige system ("Reality Collapse")
- 32+ achievements
- Auto-harvest/auto-plant with LED indicators
- Quantum events (random popups with bonuses)
- Narrative system with 60+ story messages, glitch text, Zalgo effects
- Save/Load/Export system

---

## âœ… COMPLETED THIS SESSION

### Encoding Fixes
- Fixed UTF-8 corruption from "copy to project" action
- Restored: ğŸ’¾ğŸ—‘ï¸ğŸ“œğŸ’¡ğŸŒ¾ğŸš«ğŸ’­ and 50+ other emojis
- Fixed physics symbols: Ã— (multiply), Ã¶ (SchrÃ¶dinger), eâ»/eâº, â†’

### New Features
1. **Export Button (ğŸ“¤)** - Downloads save as .json file
2. **Load Button (ğŸ“‚)** - File picker with validation and confirmation
3. **Auto-backup** - Saves backup before loading new save
4. **Click Rate Averaging** - Shows "+X/s from clicks" during active clicking
5. **Auto-Button Progress Bars** - Visual countdown on auto-harvest/plant buttons

### Documentation
- Created `quantum-garden-design-doc-v4.md` with new feature ideas:
  - Crossed entanglement line detection (bonuses/penalties)
  - Mutation BINGO system (rows/columns of matching mutations)
  - Same-type entanglement bonuses
  - Sequential chain bonuses
  - Pattern/constellation achievements
  - File organization proposals

---

## â¬œ REMAINING TODO ITEMS

### High Priority
- **1.1 Stats/Collapse Tracking** - After prestige, some stats don't track properly
- **3.4 Entangle Chain Follows Cursor** - Visual line from source plant to mouse during selection

### Medium Priority (New Features)
- **4.1 Hoverclicker Upgrades** - Auto-click while hovering quantum core (4-tier upgrade tree)
- **4.2 Multiple Entanglements** - Allow plants to have 2+ links
- **4.3 Automated Entangler** - Auto-link unentangled plants
- **4.4 Pattern Achievements** - Detect shapes in entanglement networks

### Future/Complex
- Crossed line detection
- Mutation BINGO
- Pixel art reality shift
- ARG webcam integration
- SpacetimeDB integration for MMO elements

---

## ğŸ”§ RECOMMENDED APPROACH FOR NEXT SESSION

### Interface Recommendation: **Claude Code**

**Reasons:**
1. Can edit files directly without copy/paste corruption
2. Can run the file locally to test changes
3. Better for surgical edits (doesn't need to output entire file)
4. Can split files and manage imports naturally
5. Can run git commands directly
6. Token-efficient for large codebases

**Setup:**
```bash
cd /path/to/inc
claude  # Start Claude Code in project directory
```

### Model Recommendation: **Sonnet 4.5 for most work, Opus 4.5 for architecture decisions**

- Sonnet: Line edits, bug fixes, feature implementation, CSS tweaks
- Opus: File splitting strategy, complex system design, ARG narrative

---

## ğŸ“ FILE SPLITTING STRATEGY

**Current pain point:** 8,807 lines in one file = must read everything for any edit

**Proposed structure:**
```
quantum-garden/
â”œâ”€â”€ index.html              # Shell only (~100 lines)
â”œâ”€â”€ css/
â”‚   â””â”€â”€ styles.css          # All CSS (~800 lines)
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ utils.js            # Utils, formatting (~200 lines)
â”‚   â”œâ”€â”€ state.js            # StateManager (~400 lines)
â”‚   â”œâ”€â”€ resources.js        # ResourceManager (~200 lines)
â”‚   â”œâ”€â”€ generators.js       # GeneratorManager (~300 lines)
â”‚   â”œâ”€â”€ upgrades.js         # UpgradeManager (~400 lines)
â”‚   â”œâ”€â”€ garden.js           # GardenManager (~600 lines)
â”‚   â”œâ”€â”€ quantum.js          # QuantumMechanics (~800 lines)
â”‚   â”œâ”€â”€ prestige.js         # PrestigeManager (~200 lines)
â”‚   â”œâ”€â”€ narrative.js        # NarrativeSystem (~600 lines) â† LARGE
â”‚   â”œâ”€â”€ achievements.js     # AchievementManager (~300 lines)
â”‚   â”œâ”€â”€ tutorial.js         # Tutorial system (~200 lines)
â”‚   â”œâ”€â”€ ui.js               # UI module (~1500 lines) â† LARGEST
â”‚   â””â”€â”€ main.js             # Init, game loop (~300 lines)
â””â”€â”€ data/
    â”œâ”€â”€ game-data.js        # All GameData definitions (~800 lines)
    â””â”€â”€ narrative-text.js   # All story text separate (~500 lines)
```

**Benefits:**
- Edit one module without loading others
- Clear separation of concerns
- Easier debugging
- Multiple devs can work on different files
- Token-efficient for AI assistance

**Migration approach:**
1. Create folder structure
2. Extract CSS first (lowest risk)
3. Extract GameData (pure data, no dependencies)
4. Extract Utils (no dependencies)
5. Extract managers one at a time, testing after each
6. Keep one working monolith as backup

---

## ğŸ® LONG-TERM: SPACETIMEDB INTEGRATION

**Current SpacetimeDB version:** 1.1.0 (running for ARG site)

**Integration points for Quantum Garden:**
- Shared leaderboards (total energy, reality level, achievements)
- Cross-player "quantum entanglement" (link gardens across players?)
- ARG discovery system (first player to find X unlocks for all)
- Seasonal events with server-side state
- Anti-cheat for save validation

**Tables needed:**
```rust
#[spacetimedb::table]
pub struct Player {
    #[primarykey]
    identity: Identity,
    display_name: String,
    reality_level: u32,
    total_energy: u64,
    first_seen: Timestamp,
    last_seen: Timestamp,
}

#[spacetimedb::table]
pub struct Discovery {
    #[primarykey]
    id: String,
    discovered_by: Identity,
    discovered_at: Timestamp,
    discovery_type: String,  // "pattern", "achievement", "secret"
}
```

---

## âš ï¸ KNOWN ISSUES

1. **UTF-8 Corruption:** "Copy to project" in Claude.ai corrupts emojis. Use downloadâ†’upload instead.
2. **Stats after Prestige:** Some tracking breaks after Reality Collapse - needs investigation
3. **Mobile:** Not fully responsive, touch support incomplete
4. **Performance:** Many entanglement lines (SVG) may lag on low-end devices

---

## ğŸ’¡ TIM'S DESIGN NOTES (From This Session)

- "Crossed entanglement lines could be detected for bonuses or even bad effects"
- "Trying to NOT cross lines would be a riot"
- "Shorting out... even costing you energy loss(!)"
- "Something akin to BINGO with mutations - full row/column of matching mutations"
- "Same plant AND mutation entangle bonus"
- "Chain that goes lilyâ†’tulipâ†’roseâ†’etc for sequence bonus"
- "This game WILL be infinitely complex"
- The game is frontend for "a very messed up ARG"
- Zalgo text and cosmic horror vibes are intentional

---

## ğŸš€ SUGGESTED FIRST TASK FOR NEXT SESSION

**If using Claude Code:** Start with file splitting
1. Create the folder structure
2. Extract CSS to `css/styles.css`
3. Test that the game still works
4. Extract `data/game-data.js`
5. Continue one module at a time

**If using Claude.ai:** Work on a single focused feature
- Recommend: 3.4 Entangle chain follows cursor (self-contained, visual feedback)
- Or: 4.1 Hoverclicker upgrades (new feature, doesn't touch core systems)

---

*Document created: December 16, 2024*
*For: Tim / Quantum Garden project*
*Next instance should read design-doc-v4.md and todo.md before starting*
